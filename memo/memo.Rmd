---
title: "Project memo"
author: "Team name"
output: github_document
always_allow_html: true
---


```{r load-packages, message = FALSE}
library(tidyverse)
library(broom)
library(readxl)
library(leaflet)
library(RColorBrewer)
library(htmlwidgets)

squirrels <- read_csv("../data/2018_Central_Park_Squirrel_Census_-_Squirrel_Data.csv")

```



## Loading the RColorBrewer pallette "Paired," which includes pairs of light
## and dark shades.

```{r color-brewer}

my_colors <- brewer.pal(n = 4, name = "Paired")


```



### Final Plot 1 - Leaflet Map:

To build the leaflet map, the first step was to create separate variables for
the latitude and longitude, as both were combined in the original dataset. This was the most intensive data cleaning necessary for the project. The code then generates the base OpenStreetMap layer, as well as grouped circle markers for each squirrel.

```{r leaflet-map}

squirrels <- squirrels |>
  mutate(lng = substring(`Lat/Long`, 8, 22),
         lat = substring(`Lat/Long`, 26, 40))

squirrels$lng <- as.numeric(squirrels$lng)
squirrels$lat <- as.numeric(squirrels$lat)

squirrels_map <- leaflet(squirrels) |>
  addTiles() |>
  setView(lng = -73.9651,
          lat = 40.7833,
          zoom = 13) |>
  addCircleMarkers(lat = ~lat, 
             lng = ~lng, 
             clusterOptions = markerClusterOptions(),
             color = squirrels$`Primary Fur Color`,
             fillColor = squirrels$`Primary Fur Color`,
             popup = squirrels$`Unique Squirrel ID`)

saveWidget(squirrels_map, file = "index.html", selfcontained = TRUE)

```



### Final Plot 2:


```{r squirrel-activities}
activities <- squirrels |>
  mutate("No Activity" = case_when (Running == FALSE & 
                                    Chasing == FALSE & 
                                    Climbing == FALSE & 
                                    Eating == FALSE & 
                                    Foraging == FALSE
                                    ~ TRUE,
                                  )) |>
  select(Shift, Running, Chasing, Climbing, Eating, Foraging, "No Activity") |>
  pivot_longer(
    cols = c(Running, Chasing, Climbing, Eating, Foraging, "No Activity"),
    names_to = "Activity",
    values_to = "Observed"
  ) |>
  filter(Observed == TRUE) |>
  count(Activity, Shift, name = "Frequency") |>
  group_by(Activity) |>
  mutate(Total_Frequency = sum(Frequency)) |>
  ungroup() |>
  group_by(Shift) |>
  mutate(Percent = (100*(Frequency / sum(Frequency)))) |>
  ungroup()

ggplot(activities, aes(x = reorder(Activity, -Total_Frequency), 
                      y = Percent, fill = Shift)) +
  geom_col(position = "dodge") +
  labs(
    title = "Comparison of Squirrel Activities",
    x = "Squirrel Behavior",
    y = "Percentage"
  ) +
  scale_fill_brewer(palette = "Paired")
  ggsave("squirrelActivity.png", plot = get_last_plot(), width = 6, height = 3)
```


#### Final Plot 3

```{r squirrel-human-behavior}

squirrels %>%
  select(Shift, Approaches, Indifferent, `Runs from`) %>%
  pivot_longer(
    cols = c(Approaches, Indifferent, `Runs from`),
    names_to = "Interaction",
    values_to = "Observed"
  ) %>%
  filter(Observed == TRUE) %>%
  count(Shift, Interaction, name = "Frequency") %>%
  ggplot(aes(
    x = Interaction,
    y = Frequency,
    fill = Shift 
  )) +
  geom_col(position = "dodge") +
  labs(
    title = "Squirrel-Human interactions by time of shift (AM or PM)",
    x = "Squirrel Behavior",
    y = "Number of Squirrels Observed Exhibiting Behavior",
    fill = "Time of shift"
  ) 

```

### Plot 3: ___________

Add more plot sections as needed. Each project should have at least 3 plots, but talk to me if you have fewer than 3.

### Plot 4: ___________ 

